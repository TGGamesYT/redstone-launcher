<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Redstone Launcher</title>
 <link rel="stylesheet" href="server.css" />
 <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
<div id="toolbar">
  <div class="toolbar-buttons-left">
      <button id="backBtn">⬅</button>
      <button id="forwardBtn">➡</button>
  </div>
<div class="drag-region">Redstone Launcher</div>
<div class="toolbar-buttons">
    <button id="min-btn">—</button>
    <button id="max-btn">◻</button>
    <button id="close-btn">✕</button>
</div>
</div>
<div class="sidebar">
  <ul class="menu top">
    <a href="index.html"><li><i class="material-icons">home</i><span>Home</span></li></a>
    <a href="instances.html"><li><i class="material-icons">play_arrow</i><span>Instances</span></li></a>
    <a href="modrinth.html" class="modrinth"><li><span>Modrinth</span></li></a>
    <a href="server.html"><li><i class="material-icons">storage</i><span>Server Manager</span></li></a>
  </ul>
  <ul class="menu middle" id="instances">
    <li><i class="material-icons">add</i><span>Add an instance</span></li>
  </ul>
  <ul class="menu bottom">
    <li id="update"><i class="material-icons">download</i><span id="updateText">Download the latest update</span></li>
    <li><a href="profile-manager.html"><i class="material-icons">face</i></a><span>Skin, cape changer</span></li>
    <a href="players.html"><li id="players-login"><i class="material-icons">login</i><span>Login</span></li></a>
    <li><a href="settings.html"><i class="material-icons">settings</i></a><span>Settings</span></li>
  </ul>
</div>
<div id="news-modal">
  <div id="news-modal-content">
    <span id="news-modal-close">&times;</span>
    <div id="news-modal-body"></div>
  </div>
</div>
<div id="content">
  <div id="main">
    <h1>Welcome back!</h1>
    <section id="continue-playing">
      <h3 id="continue-title">Continue Playing</h2>
      <ul id="profiles-list"></ul>
    </section>

    <section id="discover">
      <h2>Discover</h2>
      <p>Coming soon...</p>
    </section>
  </div>

  <div id="news-potw">
    <section id="news">
      <h2>News</h2>
      <div id="news-content"></div>
      <div id="news-dots"></div>
    </section>

    <section id="potw">
      <img id="potw-icon" src="">
      <span id="potw-title"></span>
    </section>
  </div>
</div>

<script>
const { ipcRenderer, shell } = require('electron');
let selectedPlayerId = null;

// ------------------ CONTINUE PLAYING ------------------
ipcRenderer.send('get-profiles-latest');
ipcRenderer.on('profiles-list', (e, profiles) => {
  doshit(profiles)
});
ipcRenderer.on('profiles-updates', (e, profiles) => {
  doshit(profiles)
});

function doshit(profiles){
  const list = Array.isArray(profiles) ? profiles.slice(0,3) : [];
  const profilesList = document.getElementById("profiles-list");
  const title = document.getElementById("continue-title");
  profilesList.innerHTML = "";
  title.textContent = "Continue Playing";
  title.onclick = () => {
    shell.openExternal("https://youtu.be/XOq97dxiAfE");
  };
  title.style.cursor = 'help';
  if (list.length == 0) {
    title.textContent = "Start Playing";
    const li = document.createElement("li");
    li.className = "profile-item";

    const img = document.createElement("img");
    img.src = "https://tggamesyt.dev/assets/redstone_launcher_defaulticon.png";
    li.appendChild(img);

    const info = document.createElement("div");
    info.className = "profile-info";

    const name = document.createElement("div");
    name.className = "profile-name";
    name.textContent = "Create An instance";
    info.appendChild(name);

    li.appendChild(info);

    const launchBtn = document.createElement("button");
    launchBtn.innerHTML = `+`;
    launchBtn.onclick = () => {
      window.location.href = "instances.html?i=NEWINSTANCE";
    };
    li.appendChild(launchBtn);

    profilesList.appendChild(li);
  }

  list.forEach(p => {
      const li = document.createElement("li");
      li.className = "profile-item";

      const img = document.createElement("img");
      img.src = p.icon || "https://tggamesyt.dev/assets/redstone_launcher_defaulticon.png";
      li.appendChild(img);

      const info = document.createElement("div");
      info.className = "profile-info";

      const name = document.createElement("div");
      name.className = "profile-name";
      name.textContent = p.name;
      info.appendChild(name);

      const details = document.createElement("div");
      details.className = "profile-details";
      details.textContent = `v${p.version} • ${p.loader}`;
      info.appendChild(details);

      li.appendChild(info);

      const launchBtn = document.createElement("button");
      launchBtn.className = "play-button";
      launchBtn.innerHTML = `<i class="material-icons">play_arrow</i>`; // placeholder icon
      launchBtn.onclick = () => {
        if (!selectedPlayerId) return alert("Select a player first!");
        ipcRenderer.send("launch-profile", { profileId: p.id, playerId: selectedPlayerId });
        window.location.href = `instances.html?i=${p.id}`;
      };
      li.appendChild(launchBtn);

      profilesList.appendChild(li);

  });
};

// ------------------ DISCORD PRESENCE ------------------
  function updatePresence(details, state = "Idle") {
  ipcRenderer.send('update-discord-presence', { details, state });
}
  updatePresence("In Launcher")
</script>
<script src="sidebar.js"></script>
</body>
</html>
