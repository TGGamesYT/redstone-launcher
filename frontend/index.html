<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Redstone Launcher</title>
</head>
<body>
  <h1>Redstone Launcher</h1>
  <a href="server.html">server manager</a> <br>
  <a href="profile-manager.html">profile manager</a> <br>
  <button id="openModrinth">Browse Modrinth</button>
  <!-- ─────────────── Players Section ─────────────── -->
  <h2>Players</h2>
  <div>
    <label>
      Cracked username:
      <input id="crackedName" placeholder="Steve" />
    </label>
    <button id="createCrackedBtn">Add Cracked Player</button>
    <button id="loginMicrosoftBtn">Login Microsoft</button>
  </div>
  <ul id="players-list"></ul>

  <!-- ─────────────── Profiles Section ─────────────── -->
  <h2>Game Profiles</h2>
  <div>
    <label>
      Profile name:
      <input id="profileName" placeholder="Vanilla 1.20" />
    </label>
    <label>
      Version:
      <input id="profileVersion" value="1.20.1" />
    </label>
    <label>
      Loader:
      <input id="profileLoader" value="vanilla" />
    </label>
    <button id="createProfileBtn">Create Game Profile</button>
  </div>
  <ul id="profiles-list"></ul>

  <h2>Logs</h2>
  <pre id="logs" style="height:200px; overflow:auto;"></pre>

  <script>
    const { ipcRenderer } = require("electron");

    document.addEventListener("DOMContentLoaded", () => {
      const crackedName = document.getElementById("crackedName");
      const createCrackedBtn = document.getElementById("createCrackedBtn");
      const loginMicrosoftBtn = document.getElementById("loginMicrosoftBtn");
      const playersList = document.getElementById("players-list");
      const profileName = document.getElementById("profileName");
      const profileVersion = document.getElementById("profileVersion");
      const profileLoader = document.getElementById("profileLoader");
      const createProfileBtn = document.getElementById("createProfileBtn");
      const profilesList = document.getElementById("profiles-list");
      const logs = document.getElementById("logs");
        document.getElementById("openModrinth")
    .addEventListener("click", () => ipcRenderer.send("open-modrinth-browser"));

      let players = [];

      // Buttons
      createCrackedBtn.addEventListener("click", () => {
        const name = crackedName.value.trim();
        if (!name) { alert("Enter a cracked username"); return; }
        ipcRenderer.send("create-cracked-player", name);
        crackedName.value = "";
      });

      loginMicrosoftBtn.addEventListener("click", () => {
        ipcRenderer.send("login-microsoft");
      });

      createProfileBtn.addEventListener("click", () => {
        const name = profileName.value.trim();
        const version = profileVersion.value.trim();
        const loader = profileLoader.value.trim();
        if (!name || !version) {
          alert("Fill profile name and version");
          return;
        }
        ipcRenderer.send("create-profile", { name, version, loader });
        profileName.value = "";
        profileVersion.value = "1.20.1";
        profileLoader.value = "vanilla";
      });

      // IPC handlers - Players
      ipcRenderer.on("players-list", (event, newPlayers) => {
        players = newPlayers;
        playersList.innerHTML = "";
        players.forEach(p => {
          const li = document.createElement("li");
          const display = p.username ?? (p.auth?.selectedProfile?.name ?? "MS Account");
          li.textContent = `[${p.type}] ${display} (id: ${p.id})`;
          playersList.appendChild(li);
        });
      });

      ipcRenderer.on("players-updated", (event, newPlayers) => {
        ipcRenderer.emit("players-list", null, newPlayers);
      });

      // IPC handlers - Profiles
      ipcRenderer.on("profiles-list", (event, profiles) => {
        profilesList.innerHTML = "";
        profiles.forEach(p => {
          const li = document.createElement("li");
          li.textContent = `${p.name} (v${p.version}) `;

          // Player selection dropdown
          const select = document.createElement("select");
          const defaultOpt = document.createElement("option");
          defaultOpt.value = "";
          defaultOpt.textContent = "-- select player --";
          select.appendChild(defaultOpt);
          players.forEach(pl => {
            const opt = document.createElement("option");
            opt.value = pl.id;
            opt.textContent = `${pl.username ?? (pl.auth?.selectedProfile?.name ?? "MS Account")} (${pl.type})`;
            select.appendChild(opt);
          });
          li.appendChild(select);

          // Launch button
          const launchBtn = document.createElement("button");
          launchBtn.textContent = "Launch";
          launchBtn.onclick = () => {
            const playerId = Number(select.value);
            if (!playerId) { alert("Select a player to launch"); return; }
            ipcRenderer.send("launch-profile", { profileId: p.id, playerId });
          };
          li.appendChild(launchBtn);

          profilesList.appendChild(li);
        });
      });

      ipcRenderer.on("profiles-updated", (event, profiles) => {
        ipcRenderer.emit("profiles-list", null, profiles);
      });

      // Logs
      ipcRenderer.on("launcher-log", (event, msg) => {
        logs.textContent += msg + "\n";
        logs.scrollTop = logs.scrollHeight;
      });
      ipcRenderer.on("launch-error", (event, msg) => {
        logs.textContent += "[ERROR] " + msg + "\n";
        logs.scrollTop = logs.scrollHeight;
      });
      ipcRenderer.on("login-error", (event, msg) => {
        logs.textContent += "[LOGIN ERROR] " + msg + "\n";
        logs.scrollTop = logs.scrollHeight;
      });

      // initial load
      ipcRenderer.send("get-players");
      ipcRenderer.send("get-profiles");
    });
  </script>
</body>
</html>
